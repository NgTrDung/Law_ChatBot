<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Gemini-Style Chatbot UI</title>
    <link rel="stylesheet" href="../static/style.css">
</head>
<body>
    <div class="chat-container">
        <div class="sidebar">
            <button class="toggle-button" onclick="toggleSidebar()">&#9776;</button>
            <div class="sidebar-content" id="sidebar">
                <h3>Menu</h3>
                <ul>
                    <li><a href="#">New Chat</a></li>
                    <li><a href="#">Đổi Mô Hình</a></li>
                    <li><a href="#">Đăng Xuất</a></li>
                </ul>
            </div>
        </div>
        <div class="main-content">
            <div class="header">
                <img src="https://png.pngtree.com/png-vector/20230225/ourmid/pngtree-smart-chatbot-cartoon-clipart-png-image_6620453.png" alt="Chatbot" class="chatbot-image">
                <h2>VietNamese Law Chatbot</h2>
            </div>
            <div class="chat-box" id="chat-output">
                <div class="chat-message bot">
                    <div class="avatar bot-avatar" style="background-image: url('https://media.istockphoto.com/id/2148171304/vector/chatbot-avatar.jpg?s=612x612&w=0&k=20&c=ipIX_zqUkcRsYyI_CSO5eIDm_sjtbCwWVMVWRVp07PE=');"></div>
                    <div class="message">Hello! How can I help you today?</div>
                </div>
                <div class="chat-message user">
                    <div class="avatar user-avatar" style="background-image: url('https://media.istockphoto.com/id/1300845620/vector/user-icon-flat-isolated-on-white-background-user-symbol-vector-illustration.jpg?s=612x612&w=0&k=20&c=yBeyba0hUkh14_jgv1OKqIH0CCSWU_4ckRkAoy2p73o=');"></div>
                    <div class="message">I need information about my order status.</div>
                </div>
            </div>
            <div class="input-area">
                <input type="text" id="user-query" placeholder="Type a message..." />
                <button id="send-button" type="button">Send</button>
                <span id="loading-indicator" class="loading-indicator" style="display: none;"></span>
            </div>
        </div>
    </div>
    <script>
        let isLoading = false; // Biến trạng thái để theo dõi trạng thái gửi yêu cầu

        document.getElementById('send-button').addEventListener('click', function() {
            const query = document.getElementById('user-query').value; // Lấy giá trị từ input
            if (!query || isLoading) return; // Không gửi yêu cầu nếu ô nhập rỗng hoặc đang tải

            isLoading = true; // Đặt trạng thái đang tải
            document.getElementById('loading-indicator').textContent = "Loading..."; // Hiển thị thời gian chờ

            // Gửi yêu cầu tới API Flask
            fetch('http://127.0.0.1:5000/chatbot', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ query: query }) // Đóng gói dữ liệu
            })
            .then(response => response.json())
            .then(data => {
                // Hiển thị câu trả lời từ chatbot
                const chatOutput = document.getElementById('chat-output');
                chatOutput.innerHTML += `<div class="chat-message user">
                                                <div class="avatar user-avatar" style="background-image: url('https://media.istockphoto.com/id/1300845620/vector/user-icon-flat-isolated-on-white-background-user-symbol-vector-illustration.jpg?s=612x612&w=0&k=20&c=yBeyba0hUkh14_jgv1OKqIH0CCSWU_4ckRkAoy2p73o=');"></div>
                                                <div class="message">${query}</div>
                                            </div>`;
                chatOutput.innerHTML += `<div class="chat-message bot">
                                                <div class="avatar bot-avatar" style="background-image: url('https://media.istockphoto.com/id/2148171304/vector/chatbot-avatar.jpg?s=612x612&w=0&k=20&c=ipIX_zqUkcRsYyI_CSO5eIDm_sjtbCwWVMVWRVp07PE=');"></div>
                                                <div class="message">${data.answer}</div>
                                            </div>`;
                document.getElementById('user-query').value = ''; // Xóa ô nhập
                chatOutput.scrollTop = chatOutput.scrollHeight; // Cuộn xuống cuối

                isLoading = false; // Đặt lại trạng thái sau khi nhận được phản hồi
                document.getElementById('loading-indicator').textContent = ""; // Ẩn thời gian chờ
            })
            .catch(error => {
                console.error('Error:', error);
                isLoading = false; // Đặt lại trạng thái nếu có lỗi
                document.getElementById('loading-indicator').textContent = ""; // Ẩn thời gian chờ
            });
        });

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('active');
        }
    </script>
</body>
</html>
