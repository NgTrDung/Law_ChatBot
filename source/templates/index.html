<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Gemini-Style Chatbot UI</title>
    <link rel="stylesheet" href="../static/style.css">
</head>
<body>
    <div class="chat-container">
        <div class="sidebar">
            <button class="toggle-button" onclick="toggleSidebar()">&#9776;</button>
            <div class="sidebar-content" id="sidebar">
                <h3>Menu</h3>
                <ul>
                    <li><a href="#">New Chat</a></li>
                    <li><a href="#">Đổi Mô Hình</a></li>
                    <li><a href="#">Đăng Xuất</a></li>
                </ul>
            </div>
        </div>
        <div class="main-content">
            <div class="header">
                <img src="https://png.pngtree.com/png-vector/20230225/ourmid/pngtree-smart-chatbot-cartoon-clipart-png-image_6620453.png" alt="Chatbot" class="chatbot-image">
                <h2>VietNamese Law Chatbot</h2>
            </div>
            <div class="chat-box" id="chat-output">
                <div class="chat-message bot">
                    <div class="avatar bot-avatar" style="background-image: url('https://media.istockphoto.com/id/2148171304/vector/chatbot-avatar.jpg?s=612x612&w=0&k=20&c=ipIX_zqUkcRsYyI_CSO5eIDm_sjtbCwWVMVWRVp07PE=');"></div>
                    <div class="message">Hello! How can I help you today?</div>
                </div>
                <div class="chat-message user">
                    <div class="avatar user-avatar" style="background-image: url('https://media.istockphoto.com/id/1300845620/vector/user-icon-flat-isolated-on-white-background-user-symbol-vector-illustration.jpg?s=612x612&w=0&k=20&c=yBeyba0hUkh14_jgv1OKqIH0CCSWU_4ckRkAoy2p73o=');"></div>
                    <div class="message">I need information about my order status.</div>
                </div>
            </div>
            <div class="input-area">
                <input type="text" id="user-query" placeholder="Type a message..." />
                <button id="send-button" type="button">Send</button>
                <span id="loading-indicator" class="loading-indicator" style="display: none;"></span>
            </div>
        </div>
    </div>
    <script>
        let isLoading = false; 
        document.getElementById('send-button').addEventListener('click', function() {
            const query = document.getElementById('user-query').value; 
            if (!query || isLoading) return; 
            isLoading = true; 
            document.getElementById('loading-indicator').textContent = "Loading..."; 
            fetch('http://127.0.0.1:5000/chatbot', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ query: query }) 
            })
            .then(response => response.json())
           // Đoạn mã trong file HTML (chỉnh lại đoạn then để xử lý danh sách)
            .then(data => {
                const chatOutput = document.getElementById('chat-output');
                chatOutput.innerHTML += `<div class="chat-message user">
                                            <div class="avatar user-avatar" style="background-image: url('https://media.istockphoto.com/id/1300845620/vector/user-icon-flat-isolated-on-white-background-user-symbol-vector-illustration.jpg?s=612x612&w=0&k=20&c=yBeyba0hUkh14_jgv1OKqIH0CCSWU_4ckRkAoy2p73o=');"></div>
                                            <div class="message">${query.replace(/\n/g, '<br>')}</div>
                                        </div>`;

                // Kiểm tra nếu data.answer là mảng (list)
                if (Array.isArray(data.answer)) {
                    // Duyệt qua từng phần tử của danh sách và tạo các tin nhắn
                    data.answer.forEach(item => {
                        chatOutput.innerHTML += `<div class="chat-message bot">
                                                    <div class="avatar bot-avatar" style="background-image: url('https://media.istockphoto.com/id/2148171304/vector/chatbot-avatar.jpg?s=612x612&w=0&k=20&c=ipIX_zqUkcRsYyI_CSO5eIDm_sjtbCwWVMVWRVp07PE=');"></div>
                                                    <div class="message">${item.replace(/\n/g, '<br>')}</div>
                                                </div>`;
                    });
                } else {
                    // Nếu không phải là mảng, chỉ hiển thị như một tin nhắn
                    chatOutput.innerHTML += `<div class="chat-message bot">
                                                <div class="avatar bot-avatar" style="background-image: url('https://media.istockphoto.com/id/2148171304/vector/chatbot-avatar.jpg?s=612x612&w=0&k=20&c=ipIX_zqUkcRsYyI_CSO5eIDm_sjtbCwWVMVWRVp07PE=');"></div>
                                                <div class="message">${data.answer.replace(/\n/g, '<br>')}</div>
                                            </div>`;
                }

                document.getElementById('user-query').value = ''; 
                chatOutput.scrollTop = chatOutput.scrollHeight; 
                isLoading = false; 
                document.getElementById('loading-indicator').style.display = "none"; 
            })
        });

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('active');
        }
    </script>
</body>
</html>
